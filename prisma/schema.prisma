// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Venue {
  id           String       @id @default(cuid())
  name         String
  lat          Float
  lng          Float
  address      String
  neighborhood String
  rating       Float?
  priceLevel   Int?

  // External API IDs
  yelpId          String?   @unique
  googlePlaceId   String?   @unique
  foursquareId    String?   @unique
  liquorLicenseId String?

  // Meeting potential scoring
  meetingScore       Float?  // 0-100 composite score
  genderRatio        Json?   // { male: 60, female: 40, confidence: "medium" }
  avgAge             Int?    // Average crowd age
  socialibilityScore Float?  // 0-100
  venueType          String? // "bar", "lounge", "nightclub", etc.

  // 311 Complaint data (KEY FEATURE)
  noiseComplaints  Int?      @default(0) // Last 90 days
  complaintPattern Json?     // Weekly pattern data
  lastComplaint    DateTime?

  // Review sentiment (Claude NLP)
  reviewSentiment Json? // NLP analysis results

  // Live event data (Eventbrite)
  events Json? // Tonight's events {eventName, eventUrl, eventTime, eventType}

  // NYC Cabaret licenses (static validation)
  cabaretLicense     Boolean? @default(false)
  cabaretLicenseType String?  // "Class 1 Cabaret", "Class 2 Cabaret"

  // Google Popular Times (future)
  popularTimes Json? // Hourly busyness patterns

  // AI-generated insights (future Phase 3)
  aiSummary    Json? // Google AI summary
  aiParsedData Json? // Claude-extracted structured data

  // Data freshness
  dataLastFetched DateTime?

  // Two-layer architecture
  dataLayer  String    @default("base") // "base" | "enriched"
  enrichedAt DateTime?

  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
  moods     VenueMood[]

  @@index([lat, lng])
  @@index([meetingScore])
  @@index([noiseComplaints])
  @@index([dataLayer])
  @@map("venues")
}

model VenueMood {
  id       String @id @default(cuid())
  venueId  String
  mood     String
  venue    Venue  @relation(fields: [venueId], references: [id], onDelete: Cascade)

  @@unique([venueId, mood])
  @@index([mood])
  @@map("venue_moods")
}
